<!DOCTYPE html>
<html>
<head>
    <title>Safe-Zone Seeding Simple Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Safe-Zone Seeding Simple Test</h1>
    
    <div class="test-section">
        <h3>Testing Safe-Zone Seeding Implementation</h3>
        <div id="results">Loading...</div>
    </div>

    <script type="module">
        import { S, setSeed } from './js/state.js';
        import { buildBaseMesh, bindMeshAsWorld } from './js/terrain.js';
        import { generateElevation } from './js/elevation.js';
        import { seededXY, seededCell, getSeedWindow } from './js/sampling.js';

        async function runTest() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="result">Running tests...</div>';
            
            try {
                // Test 1: Basic sampling functions
                console.log('Testing basic sampling functions...');
                const testMesh = {
                    width: 1000,
                    height: 800,
                    cells: {
                        polygons: new Array(100).fill(null).map(() => new Float32Array([100, 100, 200, 100, 200, 200, 100, 200])),
                        centroids: new Float32Array(200).fill(0).map((_, i) => i % 2 === 0 ? 150 : 150)
                    }
                };
                
                const rng = () => Math.random();
                const [x, y] = seededXY(testMesh, rng, 'core');
                console.log('seededXY result:', x, y);
                
                const cellIndex = seededCell(testMesh, rng, 'hill');
                console.log('seededCell result:', cellIndex);
                
                const win = getSeedWindow('core');
                console.log('core window:', win);
                
                // Test 2: Full pipeline
                console.log('Testing full pipeline...');
                setSeed('test-seed-123');
                S.enforceSeedSafeZones = true;
                
                const mesh = buildBaseMesh();
                console.log('Mesh built:', mesh.cells.polygons.length, 'cells');
                
                bindMeshAsWorld(mesh);
                console.log('World bound');
                
                const elev = generateElevation(mesh, S);
                console.log('Elevation generated:', elev.isLand.length, 'cells');
                
                // Test 3: Verify safe zones
                const landCount = elev.isLand.reduce((a, b) => a + b, 0);
                console.log('Land cells:', landCount, 'out of', elev.isLand.length);
                
                results.innerHTML = '<div class="result success">✅ All tests passed!</div>';
                console.log('✅ Safe-zone seeding implementation working correctly');
                
            } catch (e) {
                results.innerHTML = `<div class="result error">❌ Test failed: ${e.message}</div>`;
                console.error('❌ Test failed:', e);
            }
        }

        // Run test when page loads
        runTest();
    </script>
</body>
</html>
