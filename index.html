<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' fill='%235E4FA2'/%3E%3Ccircle cx='32' cy='32' r='18' fill='white'/%3E%3C/svg%3E" />
  <link rel="manifest" href="manifest.json" />
  <title>Voronoi Heightmap Playground</title>
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/map.css">
  <link rel="stylesheet" href="css/ui.css">
</head>
<body>
  <div class="flex-container">
    <div id="mapContainer" class="map-container">
      <svg id="map" width="1280" height="560" viewBox="0 0 1280 560" role="img" aria-label="Voronoi heightmap canvas" class="map-svg"></svg>
      
      <!-- Progress Overlay -->
      <div id="progressOverlay" class="progress-overlay">
        <div class="progress-content">
          <div class="progress-title">Generating Map...</div>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
          <div id="progressText" class="progress-text">Initializing...</div>
          <div id="progressDetail" class="progress-detail"></div>
        </div>
      </div>
    </div>
    
    <div id="biomeLegend" class="biome-legend">
      <h4 class="legend-title">Biome Legend</h4>
      <div id="legendItems" class="legend-items"></div>
    </div>
  </div>

  <div class="controls">
    <div class="row">
      <button id="generateBtn" class="primary-btn">Generate Map</button>
      <button id="settingsBtn" class="settings-btn">⚙️ Settings</button>
      <button id="regenNamesBtn" class="primary-btn">Regenerate Names</button>
      <button id="viewToggleBtn" class="primary-btn">Show Regions</button>
    </div>

    <div class="row">
      <button>Export SVG</button>
      <button>Export PNG</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Map Settings</h2>
        <span class="close">&times;</span>
      </div>
      
      <div class="modal-body">
        <div class="settings-tabs">
          <button class="tab-btn active">Terrain</button>
          <button class="tab-btn">Climate</button>
          <button class="tab-btn">Settlements</button>
          <button class="tab-btn">Routes</button>
        </div>

        <!-- Terrain Tab -->
        <div id="terrain-tab" class="tab-content active">
    <div class="row">
      <label>Graph Size:</label>
                    <input id="sizeInput" value="10000" type="range" min="100" max="25000" step="500">
      <output id="sizeOutput">10000</output>
    </div>

    <div class="row">
      <label>Max High:</label>
      <input id="highInput" value="0.9" type="range" min="0.1" max="1" step="0.01">
      <output id="highOutput">0.9</output>
    </div>

    <div class="row">
      <label>Radius:</label>
      <input id="radiusInput" value="0.9" type="range" min="0.5" max="0.999" step="0.001">
            <output id="radiusOutput">0.9</output>
            <span class="hint">(change gently!)</span>
    </div>

    <div class="row">
      <label>Sharpness:</label>
      <input id="sharpnessInput" value="0.2" type="range" min="0" max="0.5" step="0.1">
      <output id="sharpnessOutput">0.2</output>
    </div>

    <div class="row">
            <label># Small Hills:</label>
      <input id="smallCountInput" value="20" type="range" min="0" max="60" step="1">
      <output id="smallCountOutput">20</output>
            <span class="hint">(auto‑seeded)</span>
    </div>

    <div class="row">
            <label>Sea Level:</label>
            <input id="seaLevelInput" value="0.35" type="range" min="0" max="1" step="0.01">
      <output id="seaLevelOutput">0.35</output>
    </div>

    <div class="row">
            <label>Water Border (%):</label>
            <input id="borderPctInput" value="8" type="range" min="2" max="20" step="1">
      <output id="borderPctOutput">8</output>
    </div>

    <div class="row">
            <label>Min Lake Size:</label>
      <input id="minLakeSizeInput" value="3" type="range" min="1" max="10" step="1">
      <output id="minLakeSizeOutput">3</output>
    </div>

    <div class="row">
            <label>Min Lake Depth:</label>
      <input id="minLakeDepthInput" value="0.05" type="range" min="0.01" max="0.15" step="0.01">
      <output id="minLakeDepthOutput">0.05</output>
    </div>

    <div class="row">
      <label>World Type:</label>
      <select id="worldType">
        <option value="volcanicIsland">Volcanic Island</option>
        <option value="archipelago">Archipelago</option>
        <option value="continents" selected>Continents</option>
      </select>
    </div>

    <div class="row">
      <label>World Seed:</label>
      <input id="seedInput" value="" type="number" min="1" max="999999">
      <span class="hint">(leave empty for random, or set for reproducible results)</span>
    </div>

    <div class="row">
      <label>Debug Operations:</label>
      <input id="debugOpsInput" type="checkbox">
      <span>Show operation overlays</span>
    </div>

    <div class="row">
      <label>Thermal Erosion (Talus):</label>
      <input id="talusInput" value="0.02" type="range" min="0.01" max="0.05" step="0.005">
      <output id="talusOutput">0.02</output>
    </div>

    <div class="row">
      <label>Thermal Erosion (Strength):</label>
      <input id="thermalStrengthInput" value="0.5" type="range" min="0.1" max="1.0" step="0.1">
      <output id="thermalStrengthOutput">0.5</output>
    </div>

    <div class="row">
      <label>Land Smoothing (Alpha):</label>
      <input id="smoothAlphaInput" value="0.2" type="range" min="0.05" max="0.5" step="0.05">
      <output id="smoothAlphaOutput">0.2</output>
    </div>

    <div class="row">
      <label>River Style:</label>
      <select id="riverStyle">
        <option value="lines">Lines</option>
        <option value="polygons" selected>Polygonal</option>
      </select>
    </div>

    <div class="row">
      <label>River Width:</label>
      <input id="riverWidthInput" value="200" type="range" min="50" max="400" step="10">
      <output id="riverWidthOutput">200</output>
    </div>
        </div>

        <!-- Climate Tab -->
        <div id="climate-tab" class="tab-content">
          <div class="row">
            <label>Rainfall:</label>
            <input id="rainInput" value="1.0" type="range" min="0" max="2" step="0.05">
            <output id="rainOutput">1.0</output>
          </div>

          <div class="row">
            <label>Wind Belts:</label>
            <select id="windBelts">
              <option value="none" selected>None (Random)</option>
              <option value="hadley">Hadley/Ferrel/Polar</option>
            </select>
          </div>

          <div class="row">
            <label>River Density:</label>
            <input id="riverDensityInput" value="0.90" type="range" min="0.70" max="0.99" step="0.01">
            <output id="riverDensityOutput">0.90</output>
          </div>

          <div class="row">
            <label>Base Temperature (°F):</label>
            <input id="baseTempInput" value="67" type="range" min="41" max="77" step="1">
            <output id="baseTempOutput">67</output>
          </div>

          <div class="row">
            <label>Precipitation Scale:</label>
            <input id="precipScaleInput" value="1.1" type="range" min="0.1" max="2.0" step="0.1">
            <output id="precipScaleOutput">1.1</output>
          </div>

    <div class="row">
      <label>Render Mode:</label>
      <select id="renderMode">
        <option value="heightmap" selected>Heightmap</option>
        <option value="biomes">Biomes</option>
        <option value="hybrid">Hybrid</option>
      </select>
    </div>

    <div class="row">
      <label>Shaded Relief:</label>
      <select id="shadingMode">
        <option value="none" selected>None</option>
        <option value="shaded">Shaded</option>
      </select>
          </div>
    </div>

        <!-- Settlements Tab -->
        <div id="settlements-tab" class="tab-content">
          <div class="row">
            <label>Regions:</label>
            <input id="regionCount" type="number" min="1" max="20" value="3" class="region-count-input">
            <button id="applyRegionCount">Apply</button>
          </div>
        </div>

        <!-- Routes Tab -->
        <div id="routes-tab" class="tab-content"></div>
      </div>
    </div>
  </div>

  <details class="tests">
    <summary>Show Tests</summary>
    <button id="runTests">Run Tests</button>
    <button id="testComputeRoutes">Test Routes</button>
    <ol id="testResults"></ol>
  </details>

  <!-- D3 v7 (uses d3.pointer and d3-delaunay for Voronoi) -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- ES Module loader -->
  <script type="module" src="js/app.js"></script>

</body>
</html>